<app-header
  [title]="'SoTourist'"
  [iconName]="'list-outline'"
  [showBackButton]="false">
</app-header>

<ion-content
  class="viaggi-content"
  scrollEvents="true"
  (ionScroll)="onScroll($event)"
  #pageContent>

  <!-- ‚îÄ‚îÄ HERO (sticky-shrink) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
  <section
    *ngIf="inCorso || imminente"
    class="hero-trip"
    [ngStyle]="{ height: heroHeightPx }"
    (click)="onHeroClick()">

    <img
      [src]="(inCorso || imminente)!.coverPhoto || 'assets/images/PaletoBay.jpeg'"
      class="hero-bg"
      alt="cover">

    <!-- overlay grande -->
    <div class="hero-overlay" [style.opacity]="overlayOpacity">
      <h1 class="trip-type">
        {{ inCorso ? 'Viaggio in corso' : 'Il tuo prossimo viaggio' }}
      </h1>

      <h1 class="hero-title">{{ (inCorso || imminente)!.city }}</h1>
      <p class="hero-dates">
        {{ (inCorso || imminente)!.startDate | date:'dd/MM/yyyy' }} ‚Äì
        {{ (inCorso || imminente)!.endDate   | date:'dd/MM/yyyy' }}
      </p>
      <p class="hero-accommodation">
        üè® {{ (inCorso || imminente)!.accommodation || '‚Äî' }}
      </p>

      <div class="button-row" (click)="$event.stopPropagation()">
        <ion-button
          expand="block"
          class="boxes-style hero-button-main"
          (click)="openItinerary((inCorso || imminente)!.itineraryId)">
          Vai all‚Äôitinerario
        </ion-button>
        <ion-button
          fill="outline"
          class="hero-button-del"
          (click)="deleteTrip((inCorso || imminente)!.itineraryId)">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- overlay mini -->
    <div class="hero-mini" [style.opacity]="1 - overlayOpacity">
      <span class="mini-status">{{ inCorso ? 'In corso' : 'Prossimo' }}</span>
      <span class="mini-city">{{ (inCorso || imminente)!.city }}</span>
    </div>
  </section>

  <!-- ‚ñæ  CONTENUTO SOTTO  ‚ñæ ============================================-->

  <div
    *ngIf="loaded && !inCorso && !imminente && futuri.length===0 && drafts.length===0"
    class="welcome-section">
    <!-- ‚Ä¶ testo di benvenuto invariato ‚Ä¶ -->
  </div>

  <div *ngIf="!isGuest">

    <!--  marker di inizio ‚Äúzona rigida‚Äù  -->
    <div #collapseStartMarker></div>

    <!-- Viaggio imminente -->
    <div *ngIf="imminente" class="trip-section" [hidden]="!inCorso">
      <h2 class="Title_sezion">Viaggio imminente</h2>
      <app-trip-card
        [trip]="imminente"
        (open)="openItinerary(imminente.itineraryId)"
        (remove)="deleteTrip(imminente.itineraryId)">
      </app-trip-card>
    </div>

    <!-- Prossimi viaggi -->
    <div *ngIf="futuri.length>0" class="trip-section">
      <h2 class="Title_sezion">Prossimi viaggi</h2>
      <div class="card-grid">
        <app-trip-card
          *ngFor="let trip of futuri"
          [trip]="trip"
          (open)="openItinerary(trip.itineraryId)"
          (remove)="deleteTrip(trip.itineraryId)">
        </app-trip-card>
      </div>
    </div>
  </div>

  <!-- Bozze offline -->
  <div *ngIf="drafts.length>0" class="trip-section">
    <h2 class="Title_sezion">Bozze</h2>
    <div class="card-grid">
      <app-unfinished-card
        *ngFor="let trip of drafts"
        [trip]="trip"
        (open)="openItinerary($event)"
        (remove)="deleteDraft($event)">
      </app-unfinished-card>
    </div>
  </div>

  <div class="spacer"></div>
</ion-content>

<ion-fab slot="fixed" vertical="bottom" horizontal="end" class="custom-fab">
  <ion-fab-button (click)="goToCreate()">
    <ion-icon name="add-outline"></ion-icon>
  </ion-fab-button>
</ion-fab>
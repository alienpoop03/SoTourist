<app-header [title]="'Profilo'" [iconName]="'person-circle-outline'" [showBackButton]="false"></app-header>

<ion-content class="ion-padding profile-content" fullscreen>

  <!-- CARD PROFILO UTENTE -->
  <ion-card class="profile-main-card">
    <div class="profile-main-flex">
      <app-profile-icon class="avatar-lg" [src]="profileImageUrl" [editable]="true" (changed)="profileImageUrl = $event"></app-profile-icon>
      <div>
        <h2 class="user-name">{{ username || 'Nuovo utente' }}</h2>
        <div class="user-email">{{ email || 'email@example.com' }}</div>
        <ion-badge [color]="subscriptionPlan === 'Premium' ? 'warning' : 'medium'">{{ subscriptionPlan || 'Standard' }}</ion-badge>
        <div class="profile-actions">
          <ion-button size="small" fill="outline" (click)="editing = !editing">
            <ion-icon name="create-outline"></ion-icon>
            Modifica
          </ion-button>
        </div>
      </div>
    </div>
    <div class="user-join">Iscritto dal: <b>{{ registrationDate | date:'mediumDate' }}</b></div>
    <form *ngIf="editing" class="edit-fields">
      <ion-input label="Username" [(ngModel)]="username" maxlength="20"></ion-input>
      <ion-input label="Email" [(ngModel)]="email" type="email" maxlength="50"></ion-input>
      <ion-input label="Password" [(ngModel)]="password" type="password"></ion-input>
      <ion-button expand="block" color="success" (click)="saveProfile()">Salva</ion-button>
    </form>
  </ion-card>

  <!-- ABBONAMENTO -->
  <ion-list lines="full" class="boxes-style">
    <ion-list-header>
      <ion-icon name="ribbon-outline" slot="start"></ion-icon>
      <ion-label>Abbonamento</ion-label>
    </ion-list-header>
    <ion-item>
      <ion-label>Piano: <b>{{ subscriptionPlan || 'Standard' }}</b></ion-label>
      <ion-label slot="end">Scadenza: <b>{{ subscriptionExpiry | date:'mediumDate' }}</b></ion-label>
    </ion-item>
    <ion-item lines="none" *ngIf="subscriptionPlan !== 'Premium'" button detail (click)="upgradeSubscription()">
      <ion-icon name="rocket-outline" slot="start"></ion-icon>
      <ion-label>Upgrade</ion-label>
    </ion-item>
    <ion-item *ngIf="subscriptionPlan === 'Premium'" button detail (click)="manageSubscription()">
      <ion-icon name="settings-outline" slot="start"></ion-icon>
      <ion-label>Gestisci abbonamento</ion-label>
    </ion-item>
  </ion-list>

  <!-- SICUREZZA -->
  <ion-list lines="full" class="boxes-style">
    <ion-list-header>
      <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
      <ion-label>Sicurezza</ion-label>
    </ion-list-header>
    <ion-item button detail (click)="changePassword()">
      <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
      <ion-label>Cambia password</ion-label>
    </ion-item>
    <ion-item lines="none" button detail color="danger" (click)="confirmDeleteAccount()">
      <ion-icon name="trash-outline" slot="start"></ion-icon>
      <ion-label>Elimina account</ion-label>
    </ion-item>
  </ion-list>

  <!-- LOGOUT -->
  <ion-list lines="none" class="boxes-style">
    <ion-item lines="none" button detail color="danger" (click)="confirmLogout()">
      <ion-icon name="log-out-outline" slot="start"></ion-icon>
      <ion-label>Logout</ion-label>
    </ion-item>
  </ion-list>
</ion-content>
<ion-content class="itinerario-content" fullscreen [scrollEvents]="true" (ionScroll)="onScroll($event)">

  <!-- Hero -->
  <div #hero class="hero"
     [ngStyle]="{ 
       'background-image': heroPhotoUrl ? 'url(' + heroPhotoUrl + ')' : 'none',
       'height.px': heroHeight
     }">
  <div class="overlay" [ngStyle]="{ 'opacity': overlayOpacity }">
    <h1 [ngStyle]="{ 'font-size': titleFontSize + 'rem' }">Benvenuto a: {{ trip?.city }}</h1>
    <p [ngStyle]="{ 'font-size': subtitleFontSize + 'rem' }">
      Dal {{ trip?.start | date:'dd/MM' }} al {{ trip?.end | date:'dd/MM' }}
    </p>
  </div>
</div>


 <!-- Giorni -->
  <div class="day-list">
    <ng-container *ngFor="let _ of [].constructor(daysCount); let i = index">
      <ion-card (click)="openDay(i)" class="day-card">
        <ion-card-header>
          <ion-card-title>
            ğŸ—“ Giorno {{ i + 1 }}
            <ion-button
            size="small"
            fill="clear"
            class="style-ed-btn"
            (click)="openDayCustomization(i); $event.stopPropagation()"
          >
            ğŸ“…
          </ion-button>
          
          </ion-card-title>
        </ion-card-header>
      
        <ion-card-content>
          <div *ngIf="trip?.itinerary?.[i]?.style" class="day-style">
            <strong>Stile:</strong> {{ trip.itinerary[i].style }}
          </div>
          <p>Programma per il giorno {{ i + 1 }}...</p>
        </ion-card-content>
      </ion-card>
      
    </ng-container>

    <div *ngIf="daysCount === 0" class="no-days">
      Nessun giorno da mostrare.
    </div>
  </div>


  <!-- Pulsante fluttuante -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openTripCustomization()">
      âœï¸
    </ion-fab-button>
    
  </ion-fab>

  <!-- Scheda personalizzazione -->
  <div class="customization-sheet" [class.visible]="customizationVisible">
    <div class="sheet-header">
      <h2 *ngIf="isTripCustomization">Personalizza il tuo viaggio</h2>
<h2 *ngIf="!isTripCustomization && selectedDayIndex !== null">Personalizza Giorno {{ selectedDayIndex + 1 }}</h2>

      <ion-button size="small" fill="clear" (click)="toggleCustomizationSheet()">Chiudi</ion-button>
    </div>

    <div class="sheet-content">

      <!-- ğŸ‘‡ SOLO SE Ãˆ PERSONALIZZAZIONE VIAGGIO -->
      <ng-container *ngIf="isTripCustomization">
        <ion-item>
          <ion-label position="stacked">Luogo che non vuoi perdere</ion-label>
          <ion-input placeholder="Es. Colosseo, Torre Eiffel..."></ion-input>
        </ion-item>
    
        <ion-item>
          <ion-label position="stacked">Mezzo preferito</ion-label>
          <ion-select placeholder="Scegli un mezzo">
            <ion-select-option value="a piedi">A piedi</ion-select-option>
            <ion-select-option value="auto">Auto</ion-select-option>
            <ion-select-option value="bus">Bus</ion-select-option>
            <ion-select-option value="bici">Bicicletta</ion-select-option>
          </ion-select>
        </ion-item>
    
        <ion-item>
          <ion-label position="stacked">Chiedi un consiglio all'AI</ion-label>
          <ion-textarea autoGrow="true" placeholder="Cosa vuoi chiedere?"></ion-textarea>
        </ion-item>
      </ng-container>
    
      <!-- ğŸ‘‡ SOLO SE Ãˆ PERSONALIZZAZIONE DI UN GIORNO -->
      <ng-container *ngIf="!isTripCustomization && selectedDayIndex !== null">
        <!-- Stile della giornata -->
      <ion-item>
        <ion-label position="stacked">Come vuoi passare il giorno {{ selectedDayIndex + 1 }}?</ion-label>
        <ion-select
          [(ngModel)]="trip.itinerary[selectedDayIndex].style"
          (ionChange)="saveDayStyle()"
        >
          <ion-select-option *ngFor="let style of dayStyles" [value]="style">{{ style }}</ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Atmosfera desiderata -->
      <ion-item>
        <ion-label position="stacked">Atmosfera desiderata</ion-label>
        <ion-select
          [(ngModel)]="trip.itinerary[selectedDayIndex].atmosphere"
          (ionChange)="saveDayStyle()"
        >
          <ion-select-option value="Romantica">ğŸ’• Romantica</ion-select-option>
          <ion-select-option value="Divertente">ğŸ‰ Divertente</ion-select-option>
          <ion-select-option value="Spirituale">ğŸ› Spirituale</ion-select-option>
          <ion-select-option value="Avventurosa">ğŸ§—â€â™‚ï¸ Avventurosa</ion-select-option>
          <ion-select-option value="Locale">ğŸ· Locale</ion-select-option>
        </ion-select>
      </ion-item>




      </ng-container>
    
    </div>
    
  </div>
  

</ion-content>

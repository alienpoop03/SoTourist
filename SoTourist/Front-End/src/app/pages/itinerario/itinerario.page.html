<app-navigation-bar title="Itinerario" [backUrl]="'/tabs/viaggi'"></app-navigation-bar>

<ion-content class="itinerario-content" fullscreen>

  <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SEZIONE 1 ‚Äì LUOGHI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
  <section>
    <div class="section-header">
      <ion-icon name="location-outline"></ion-icon>
      <div class="header-text">
        <span>Luoghi</span>
        <p>Tappe e luoghi gastronomici</p>
      </div>
    </div>

    <ion-list lines="inset" class="boxes-style">

      <!-- mustSee -->
      <ion-item class="item-chip-preview" button detail="false" (click)="openModal('mustSee')">
        <ion-icon name="star-outline" slot="start"></ion-icon>
        <ion-label class="item-label">
          <span class="title">Luoghi imperdibili</span>
          <div class="chip-list-inline" *ngIf="tripMustSee.length">
            <div class="chip" *ngFor="let p of tripMustSee; trackBy: trackByPlace">{{ p.name }}</div>
          </div>
        </ion-label>
        <ion-icon name="add-circle" slot="end" *ngIf="!tripMustSee.length"></ion-icon>
      </ion-item>
 
      <!-- eat -->
      <ion-item class="item-chip-preview" button detail="false" (click)="openModal('eat')">
        <ion-icon name="restaurant-outline" slot="start"></ion-icon>
        <ion-label class="item-label">
          <span class="title">Dove mangiare</span>
          <div class="chip-list-inline" *ngIf="tripEatPlaces.length">
            <div class="chip" *ngFor="let p of tripEatPlaces; trackBy: trackByPlace">{{ p.name }}</div>
          </div>
        </ion-label>
        <ion-icon name="add-circle" slot="end" *ngIf="!tripEatPlaces.length"></ion-icon>
      </ion-item>

      <!-- visited -->
      <ion-item class="item-chip-preview" lines="none" button detail="false" (click)="openModal('visited')">
        <ion-icon name="checkmark-done-outline" slot="start"></ion-icon>
        <ion-label class="item-label">
          <span class="title">Gi√† visitati</span>
          <div class="chip-list-inline" *ngIf="tripAlreadyVisited.length">
            <div class="chip" *ngFor="let p of tripAlreadyVisited; trackBy: trackByPlace">{{ p.name }}</div>
          </div>
        </ion-label>
        <ion-icon name="add-circle" slot="end" *ngIf="!tripAlreadyVisited.length"></ion-icon>
      </ion-item>

    </ion-list>
  </section>

  <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SEZIONE 2 ‚Äì PREFERENZE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
  <section>
    <div class="section-header">
      <ion-icon name="options-outline"></ion-icon>
      <div class="header-text">
        <span>Preferenze</span>
        <p>Impostazioni di viaggio e AI</p>
      </div>
    </div>

    <ion-list lines="inset" class="boxes-style">

      <ion-item button (click)="openModal('transport')">
        <ion-icon name="car-outline" slot="start"></ion-icon>
        <ion-label class="title">Mezzo preferito</ion-label>
        <div slot="end" class="simple-preview">
          <ng-container *ngIf="tripTransport; else addIconTr">{{ tripTransport }}</ng-container>
          <ng-template #addIconTr>
            <ion-icon name="chevron-up-outline"></ion-icon>
            <ion-icon name="chevron-down-outline"></ion-icon>
          </ng-template>
        </div>
      </ion-item>

      <ion-item button (click)="openModal('style')">
        <ion-icon name="balloon-outline" slot="start"></ion-icon>
        <ion-label class="title">Stile vacanza</ion-label>
        <div slot="end" class="simple-preview">{{ trip?.style || '‚Äî' }}</div>
      </ion-item>

      <ion-item lines="none" button (click)="openModal('ai')" [disabled]="true">
        <ion-icon name="chatbox-ellipses-outline" slot="start"></ion-icon>
        <ion-label class="title">Domanda all‚ÄôAI</ion-label>
        <div slot="end" class="simple-preview">
          <ng-container *ngIf="tripPrompt; else addIconAi">{{ tripPrompt }}</ng-container>
          <ng-template #addIconAi>
            <ion-icon name="chevron-up-outline"></ion-icon>
            <ion-icon name="chevron-down-outline"></ion-icon>
          </ng-template>
        </div>
      </ion-item>

    </ion-list>
  </section>

  <!-- GENERA ITINERARIO -->
  <div class="generate-container fixed">
    <ion-button class="genera-itinerario-btn" (click)="generateItinerary()" *ngIf="!isLoading && isLocalTrip">
      Genera Itinerario
    </ion-button>
    <ion-button class="genera-itinerario-btn" disabled *ngIf="isLoading">Caricamento‚Ä¶</ion-button>
    <ion-button class="genera-itinerario-btn" disabled *ngIf="!isLoading && !isLocalTrip">
      Itinerario gi√† generato
    </ion-button>
    <div class="with-floating-tabs"></div>
  </div>

  <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FLOATING MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
  <div class="modal-backdrop" *ngIf="modalVisible" (click)="closeModal(false)"></div>

  <div class="floating-modal modal-options modal-input" *ngIf="modalVisible">
    <h3 class="modal-title">{{ modalTitles[modalMode!] }}</h3>

    <!-- sezione luoghi -->
    <ng-container *ngIf="isPlaceMode(modalMode)">
      <app-google-autocomplete
        [placeholder]="getPlaceholder(modalMode!)"
        [types]="getTypes(modalMode!)"
        [bounds]="tripBounds"
        [restrictToBounds]="true"
        (placeSelected)="onPlaceSelectedInModal($event)">
      </app-google-autocomplete>

      <div class="chip-list-modal" *ngIf="modalTempPlaces.length; else emptyList">
        <div class="chip" *ngFor="let p of modalTempPlaces; let i = index">
          {{ p.name }}
          <button class="chip-remove" (click)="removeTempPlace(i)">‚úï</button>
        </div>
      </div>

      <ng-template #emptyList>
       <!-- <p class="empty-msg">Aggiungi un luogo...</p> -->
      </ng-template>

      <ion-button class="boxes-style" expand="block" (click)="saveModal()">Salva</ion-button>
    </ng-container>

    <!-- transport -->
    <ng-container *ngIf="modalMode === 'transport'">
      <ion-list inset class="options">
        <ion-item button (click)="selectValue('walk')">üö∂‚Äç‚ôÇÔ∏è A piedi</ion-item>
        <ion-item button (click)="selectValue('car')">üöó Auto</ion-item>
        <ion-item button (click)="selectValue('bus')">üöå Bus</ion-item>
        <ion-item button (click)="selectValue('bike')">üö¥‚Äç‚ôÄÔ∏è Bici</ion-item>
      </ion-list>
    </ng-container>

    <!-- style -->
    <ng-container *ngIf="modalMode === 'style'">
      <ion-list inset class="options">
        <ion-item button (click)="selectValue('Standard')">Standard</ion-item>
        <ion-item button (click)="selectValue('Shopping')">Shopping</ion-item>
        <ion-item button (click)="selectValue('Avventura')">Avventura</ion-item>
        <ion-item button (click)="selectValue('Relax')">Relax</ion-item>
      </ion-list>
    </ng-container>

    <!-- AI prompt -->
    <ng-container *ngIf="modalMode === 'ai'">
      <ion-textarea autoGrow [(ngModel)]="tripPrompt" placeholder="Scrivi qui‚Ä¶"></ion-textarea>
      <ion-button expand="block" (click)="closeModal(true)">Salva</ion-button>
    </ng-container>
  </div>

</ion-content>

<app-generation-overlay *ngIf="isLoading" [message]="'Generazione in corso‚Ä¶'"></app-generation-overlay>

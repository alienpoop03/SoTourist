<ion-page>
  <ion-content class="crea-content" scrollY="false">

    <!-- overlay di caricamento (rimane dov’era) -->
    <app-generation-overlay *ngIf="isLoading" [message]="message">
    </app-generation-overlay>

    <!--PROGRESS BAR-->
    <div class="progress-wrapper">
      <div class="progress-bar" [style.width.%]="(step - 1) * 33.333"></div>
    </div>

    <!--TRIP HEADER fisso-->
    <div class="trip-header" *ngIf="city || step > 1">
      <div class="circle-logo">
        <ion-icon name="airplane"></ion-icon>
      </div>

      <div class="trip-info">
        <!-- sostituisci SOLO queste due righe -->

<h3 class="trip-title">
  Trip to {{ confirmedCity || '...' }}
</h3>

<p class="trip-sub" *ngIf="accommodation">
  {{ confirmedAccommodation }}
</p>

      </div>
    </div>

    <!-- ░░░ CONTENUTO STEP ░░░ -->
    <div class="step-box">

      <!-- STEP 1 – città -->
      <ng-container *ngIf="step === 1">
        <h2 class="question">Dove vuoi andare?</h2>
        <input id="cityInput" [(ngModel)]="city" class="pure-input" type="text" placeholder="Es. Roma"
          autocomplete="off">
      </ng-container>

      <!-- STEP 2 – alloggio -->
      <ng-container *ngIf="step === 2">
        <h2 class="question">
          Dove alloggerai?
          <span class="optional">(facoltativo)</span>
        </h2>
        <input id="accommodationInput" [(ngModel)]="accommodation" class="pure-input" type="text"
          placeholder="Es. Hotel Centro" autocomplete="off">
      </ng-container>

      <!-- STEP 3 – selezione date “alla Ryanair” -->
      <ng-container *ngIf="step === 3">
        <!-- tab bar -->
        <div class="tabs">
          <button class="tab-btn" [class.active]="activeTab === 'departure'">
            ➜ Departure
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'return'">
            ↩︎ Return
          </button>
        </div>

        <!-- box date -->


        <!-- ⬇️ calendario visibile sotto -->
        <div class="calendar-under-tabs">
          <app-range-calendar-lite [startFromDate]="today" (datesSelected)="onRangeSelected($event)">
          </app-range-calendar-lite>
        </div>
      </ng-container>


      <!-- STEP 4 – riepilogo -->
      <ng-container *ngIf="step === 4">
        <h2 class="question">Riepilogo</h2>

        <ion-card class="summary-card">
          <ion-card-content>
            <p><strong>Città:</strong> {{ city }}</p>
            <p *ngIf="accommodation">
              <strong>Alloggio:</strong> {{ accommodation }}
            </p>
            <p>
              <strong>Date:</strong>
              {{ startDate | date:'dd/MM' }}
              →
              {{ endDate | date:'dd/MM' }}
            </p>
          </ion-card-content>
        </ion-card>
      </ng-container>

    </div><!-- /step-box -->

    <!-- ░░░ BOTTONE FISSO ░░░ -->
    <div class="bottom-button">
      <ion-button expand="block" (click)="handleStepAction()" [disabled]="!canProceedCurrentStep()">
        {{ step === 4 ? 'Salva' : 'Continua' }}
      </ion-button>
    </div>

  </ion-content>
</ion-page>
<ion-page>

  <!-- ion-content SEMPRE montato: niente *ngIf qui -->
  <ion-content fullscreen class="crea-content" [@slideIn]>

    <!-- wrapper che compare solo quando animateEntry === true -->
    <div *ngIf="animateEntry">

      <!-- INTRO -->
      <div class="intro-box">
        <h1>ðŸŽ’ Inizia il tuo viaggio</h1>
        <p>Completa questi 4 step per pianificare la tua prossima avventura.</p>
      </div>

      <!-- TIMELINE -->
      <div class="timeline-container">
        <ng-container *ngFor="let s of [1,2,3,4]; let i = index">
          <div class="timeline-step" [class.active]="step >= s" [class.current]="step === s" (click)="goToStep(s)">
            {{ s }}
          </div>
          <div class="timeline-line" *ngIf="i < 3" [class.filled]="step > s"></div>
        </ng-container>
      </div>

      <!-- WRAPPER DI TUTTI GLI STEP -->
      <div>


        <!-- STEP 2 â€“ cittÃ  & alloggio -->
        <div *ngIf="step === 2" class="step-wrapper">

          <h2>
            <ion-icon name="location-outline" class="h2-icon"></ion-icon>
            Dove stai andando?
          </h2>

          <ion-card class="location-card">
            <ion-card-content>

              <label for="cityInput" class="input-label">CittÃ </label>
              <input id="cityInput" [(ngModel)]="city" placeholder="Es. Roma" class="custom-input" />

              <label for="accommodationInput" class="input-label">Alloggio</label>
              <input id="accommodationInput" [(ngModel)]="accommodation" placeholder="Es. Hotel Roma"
                class="custom-input" />

            </ion-card-content>
          </ion-card>
        </div>

        <!-- STEP 3 â€“ con Litepicker -->
        <div *ngIf="step === 3" class="step-wrapper">

          <!-- TITOLO FISSO -->
          <div class="step-title-fixed">
            <h2>
              <ion-icon name="calendar-outline" class="h2-icon"></ion-icon>
              Quando viaggerai?
            </h2>
          </div>

          <!-- CALENDARIO SCROLLABILE -->
          <div class="step-scroll-area">
            <app-range-calendar-lite id="calendar"
              (datesSelected)="onRangeSelected($any($event))"
              [startFromDate]="today">
            </app-range-calendar-lite>
          </div>

        </div>

        <!-- PULSANTE AVANTI fuori dallo scroll -->
        <!--<div *ngIf="step === 3" class="fixed-bottom-button">
          <ion-button expand="block" [disabled]="!areDatesValid()" (click)="confirmDates()">
            Avanti
          </ion-button>
        </div>-->

        <!-- STEP 4 â€“ riepilogo -->
        <div *ngIf="step === 4" class="step-wrapper">
          <!-- Preview con il tuo componente -->
          <app-unfinished-card *ngIf="currentDraft" [trip]="currentDraft"></app-unfinished-card>

          <ion-button class="confirm-btn" expand="block" (click)="confirmSurvey()">
            Conferma e salva
          </ion-button>
        </div>

        <!-- BOTTONE FISSO UNICO -->
        <div *ngIf="step < 4" class="fixed-bottom-button">
          <ion-button expand="block" [disabled]="!canProceedCurrentStep()" (click)="handleStepAction()">
            Avanti
          </ion-button>

        </div>


      </div> <!-- /fadeInUp wrapper -->

    </div> <!-- /animateEntry wrapper -->

  </ion-content>
</ion-page>
<ion-page>

  <!-- ion-content SEMPRE montato: niente *ngIf qui -->
  <ion-content fullscreen class="crea-content" [@slideIn]>

    <!-- wrapper che compare solo quando animateEntry === true -->
    <div *ngIf="animateEntry">

      <!-- INTRO -->
      <div class="intro-box">
        <h1>üéí Inizia il tuo viaggio</h1>
        <p>Completa questi 4 step per pianificare la tua prossima avventura.</p>
      </div>

      <!-- TIMELINE -->
      <div class="timeline-container">
        <ng-container *ngFor="let s of [1,2,3,4]; let i = index">
          <div class="timeline-step" [class.active]="step >= s" [class.current]="step === s" (click)="goToStep(s)">
            {{ s }}
          </div>
          <div class="timeline-line" *ngIf="i < 3" [class.filled]="step > s"></div>
        </ng-container>
      </div>

      <!-- WRAPPER DI TUTTI GLI STEP -->
      <div [@fadeInUp]>

        <!-- STEP 1 ‚Äì modalit√† viaggio -->
        <div *ngIf="step === 1" class="step-wrapper" [@fadeStep]>
          <h2>Stai gi√† viaggiando?</h2>

          <div class="travel-mode-options">
            <div class="travel-mode-card" (click)="selectMode('vacation')">
              <ion-icon name="airplane-outline"></ion-icon>
              <span>S√¨, sono gi√† in viaggio</span>
            </div>

            <div class="travel-mode-card" (click)="selectMode('planned')">
              <ion-icon name="calendar-outline"></ion-icon>
              <span>No, voglio pianificare</span>
            </div>
          </div>
        </div>

        <!-- STEP 2 ‚Äì citt√† & alloggio -->
        <div *ngIf="step === 2" class="step-wrapper" [@fadeStep]>

          <h2>
            <ion-icon name="location-outline" class="h2-icon"></ion-icon>
            Dove stai andando?
          </h2>

          <ion-card class="location-card">
            <ion-card-content>

              <label for="cityInput" class="input-label">Citt√†</label>
              <input id="cityInput" [(ngModel)]="city" placeholder="Es. Roma" class="custom-input" />

              <label for="accommodationInput" class="input-label">Alloggio</label>
              <input id="accommodationInput" [(ngModel)]="accommodation" placeholder="Es. Hotel Roma"
                class="custom-input" />

            </ion-card-content>
          </ion-card>

          <ion-button expand="block" [disabled]="!canProceedCity()" (click)="confirmCity()">
            Avanti
          </ion-button>
        </div>

        <!-- STEP 3 ‚Äì data inizio -->
        <div *ngIf="step === 3" class="step-wrapper" [@fadeStep]>
          <h2>Quando inizia il viaggio?</h2>
          <ion-item>
            <ion-datetime presentation="date" display-format="DD MMM YYYY" (ionChange)="onStartDateChange($event)"
              [value]="startDate" [min]="today" locale="it-IT">
            </ion-datetime>
          </ion-item>
        </div>

        <!-- STEP 3.5 ‚Äì data fine -->
        <div *ngIf="step === 3.5" class="step-wrapper" [@fadeStep]>
          <h2>Quando finisce il viaggio?</h2>
          <ion-item>
            <ion-datetime presentation="date" display-format="DD MMM YYYY" (ionChange)="onEndDateChange($event)"
              [value]="endDate" [min]="startDate" locale="it-IT">
            </ion-datetime>
          </ion-item>

          <ion-button expand="block" [disabled]="!canProceedDates()" (click)="confirmDates()">
            Avanti
          </ion-button>
        </div>


        <!-- STEP 4 ‚Äì riepilogo -->
        <div *ngIf="step === 4" class="step-wrapper" [@fadeStep]>

          <!-- Preview con il tuo componente -->
          <app-unfinished-card *ngIf="currentDraft" [trip]="currentDraft"></app-unfinished-card>


          <!-- (Se vuoi ancora il riepilogo testuale, puoi tenerlo qui sotto) -->
          <!--
  <div class="summary-card">
    <h3>üìç Viaggio a {{ city }}</h3>
    <p><strong>Dal:</strong> {{ startDate | date:'fullDate' }}</p>
    <p><strong>Al:</strong> {{ endDate | date:'fullDate' }}</p>
    <p><strong>Durata:</strong> {{ calendarDays.length }} giorni</p>
  </div>
  -->

          <ion-button class="confirm-btn" expand="block" (click)="confirmSurvey()">
            Conferma e salva
          </ion-button>
        </div>



      </div> <!-- /fadeInUp wrapper -->

    </div> <!-- /animateEntry wrapper -->

  </ion-content>
</ion-page>